# 모니터링이란

## 모니터링이란

- 서비스나 제품에서 발생하는 다양한 이벤트를 감시, 추적
- 서비스 정상적인 운영
- 시스템의 정상적인 동작

## 모니터링의 목적

- 현재의 상황 파악
  - 에러
  - 트래픽
- 미래에 대한 대비
  - 트렌드
  - 신호
  - 냄새

## 모니터링의 항목

- 서비스 모니터링
  - 고객의 PV, UV, Impression
  - 검색량
  - 주문 건 수, 결제 건 수
  - 가입자, 탈퇴
  - 판매 등록
  - 핵심 사업 지표들
- 시스템 모니터링
  - CPU, 메모리, GC(Garbage Collection), Database Connection
  - Request, Throughpu, Response Time, TTI
  - 에러 개수
  - 저장소 공간 - HDD
  - SSL 인증서 만료
  - 카프카 랙

## 모니터링 방법

- 이벤트 발생
- 이벤트 수집 및 적재
  - 데이터 소스
    - ES, Loki, Prometheus, 데이터베이스, 엑셀
- 이벤트 시각화
  - 실시간
- 이벤트 알림

## 모니터링 도구 및 시각화

- **Prometheus - 오픈소스 모니터링 툴**
- **Loki - Prometheus를 모태로 Grafana Labs 개발**
- **Grafana - 오픈소스 시각화, 대시보드 툴**
- Pinpoint
- ELK 스택
- AWS, Asure, Google Cloud
- Custom Agent & Visualization

## 실전 Tips

- 서비스나 시스템의 핵심 지표만 수집
- 사업 지표와 시스템 지표 분리
- 알림과 연결

# Grafana

## Grafana?

- 자신의 서비스에서 발생하는 지표, 로그, 흔적들을 활용
  - 데이터 소스
- 데이터 소스의 조회, 시각화 및 알림 기능을 제공
- 오픈소스 소프트웨어
- 클라우드 서비스도 제공

## Grafana 기능

- 서비스나 시스템에서 발생하는 이벤트의 저장소 연결
  - 많은 데이터 소스 연결 지원
- 조회
- 시각화
  - 다양한 대시보드
- 알림

## Grafana 활용

- 시스템 모니터링
- 비즈니스 모니터링
- 임계치 설정을 통한 알림

## Grafana 실습

1. 도커로 실행

   ```bash
   docker run -d -p 3000:3000 --name grafana grafana/grafana-oss
   ```

2. 초기 계정
   - admin / admin
3. Grafana 시각화
   - 데이터 소스 설정 - MySQL
     - grafana용 별도 데이터베이스 계정을 생성
     - 직접 설치한 Grafana
       - 로컬 데이터베이스를 데이터소스로 사용할 경우 호스트 세팅 필요
       - /etc/hosts → [local.mysql.com](http://local.mysql.com) 127.0.0.1
     - Docker
       - 로컬 데이터베이스를 데이터 소스 연결시
       - host.docker.internal 사용
   - Grafana 대시보드 설정

# 서비스 알람 구축

## 서비스 알람이란

- 사물이나 상황에 대한 정보나 지식을 알게 한다.
- 알람 발행
- 알람 구독
  - 관심있는 사람 또는 시스템
- 시각적, 청각적

## 서비스 알람 내용

- 발생 지점
- 긴급도
- 가치를 포함
  - 빈약한 정보 vs 풍부한 정보
- 연관된 연결 링크 포함

## 서비스 알람 방법

- 이메일
- 화면
- 빛
- 소리
- **SMS, MMS**
- **메신저(카카오 알림톡)**
- **ARS**
- **슬랙**

## 서비스 알람 주기

- 한번만 알리기
- n번 알리기
- n시간 동안 알리기
- 응답할 때까지 알리기

## 서비스 알람 정책

- 알람 트리거 (시작 기준)
  - 데이터 임계점
  - 데이터 생성, 삭제, 수정
- 알람 타겟 (대상)
  - 개인, 그룹
- 알람 주기와 횟수
- 알람 종료 조건
  - 수동 vs 자동

## 서비스 알람 사례

- 고객 서비스
  - 급격한 주문 건 수 감소
  - 급격한 결제 건 수 감소
  - 급격한 검색량 감소
  - 급격한 매출 감소
- 판매자 서비스
  - 급격한 상품 등록 감소
  - 급격한 배송 출고 감소
  - 급격한 상품 진열 감소
- 시스템
  - CPU 사용률 증가
  - 오류 증가
  - 메모리 부족
  - 데이터베이스 커넥션 부족
  - Full GC 발생
  - API 지연
  - 카프카 메시지 랙

## 모니터링 도구와 연동

- 데이터 분석, 대시보드, 시각화 도구
  - 태블로(Tableau)
  - 그라파나(Grafana)
  - 리대시(Redash)
- Cloud Monitoring Service
- Custom Dashboard

## 실무에서의 알람

- 문자
- 카카오 알람톡
- ARS
- **슬랙**

## 실전 Tips

- 핵심 지표나 핵심 데이터 선정
- 개인보다 그룹으로 알람 타겟 설정
- 대응이 필요한 데이터나 지표만 알람
  - 스팸으로 인식되지 않도록
- 알람을 받았을 경우 바로 대음
  - 담당자 선정
  - 담당팀 선정

# Slack을 이용한 알람 서비스

1. 슬랙 워크스페이스 생성
2. 채널 생성
3. 슬랙 앱 생성
   1. 앱디렉토리로 이동
   2. 슬랙 API
   3. 관리 버튼 클릭
   4. 앱 생성 버튼 클릭
   5. 앱만들기 옵션에서 FromScratch 클릭
   6. 앱이름과 앱을 생성할 워크스페이스 선택
   7. 앱 생성 버튼 클릭
4. 생성한 앱의 Incoming Webhooks 만들기
   1. 앱 관리 화면에서 Incoming Webhooks
   2. 웹 훅을 활성화
   3. 앱의 웹훅을 워크스페이스에 추가
   4. 채널 선택
5. 생성한 앱의 웹훅 테스트
